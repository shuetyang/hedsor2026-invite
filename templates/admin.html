{% extends "base.html" %}

{% block title %}Admin - RSVP Management{% endblock %}

{% block content %}
<section class="admin-section">
    <div class="admin-container fade-in-up">
        <h1 class="admin-title">RSVP Management</h1>
        
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ stats.total }}</div>
                <div class="stat-label">Total Responses</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.attending }}</div>
                <div class="stat-label">Attending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.not_attending }}</div>
                <div class="stat-label">Not Attending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.maybe }}</div>
                <div class="stat-label">Maybe</div>
            </div>
        </div>
        
        <!-- Guest List -->
        <div class="guests-table">
            <div class="table-header">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr; gap: 1rem;">
                    <div>Name</div>
                    <div>Email</div>
                    <div>Status</div>
                    <div>Plus One</div>
                    <div>Dietary</div>
                    <div>Date</div>
                </div>
            </div>
            
            {% for guest in guests %}
            <div class="table-row" data-label="Guest {{ loop.index }}">
                <div>{{ guest.name }}</div>
                <div>{{ guest.email }}</div>
                <div>
                    {% if guest.rsvp_status == 'attending' %}
                        <span style="color: #28a745; font-weight: 600;">✓ Attending</span>
                    {% elif guest.rsvp_status == 'not_attending' %}
                        <span style="color: #dc3545; font-weight: 600;">✗ Not Attending</span>
                    {% else %}
                        <span style="color: #ffc107; font-weight: 600;">? Maybe</span>
                    {% endif %}
                </div>
                <div>{{ guest.plus_one or '-' }}</div>
                <div>{{ guest.dietary_restrictions or '-' }}</div>
                <div>{{ guest.created_at.strftime('%m/%d/%Y') }}</div>
            </div>
            {% endfor %}
            
            {% if not guests %}
            <div class="table-row" style="text-align: center; padding: 2rem;">
                <div style="grid-column: 1 / -1; color: #6B5B47;">
                    <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <p>No RSVPs yet. They will appear here once guests start responding!</p>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Export Options -->
        <div style="margin-top: 2rem; text-align: center;">
            <button onclick="exportToCSV()" class="cta-button" style="margin-right: 1rem;">
                <i class="fas fa-download"></i> Export to CSV
            </button>
            <button onclick="printGuestList()" class="cta-button" style="background: linear-gradient(135deg, #8B7355 0%, #6B5B47 100%);">
                <i class="fas fa-print"></i> Print List
            </button>
        </div>
    </div>
</section>

<script>
function exportToCSV() {
    const guests = {{ guests|tojson }};
    let csv = 'Name,Email,Status,Plus One,Dietary Restrictions,Message,Date\n';
    
    guests.forEach(guest => {
        const row = [
            `"${guest.name}"`,
            `"${guest.email}"`,
            `"${guest.rsvp_status}"`,
            `"${guest.plus_one || ''}"`,
            `"${guest.dietary_restrictions || ''}"`,
            `"${guest.message || ''}"`,
            `"${guest.created_at}"`
        ].join(',');
        csv += row + '\n';
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'wedding_rsvps.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function printGuestList() {
    window.print();
}

// Auto-refresh every 30 seconds
setInterval(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}
